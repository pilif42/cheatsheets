- An example to test a service:

@ExtendWith(MockitoExtension.class)
public class BfinServiceImplTest {

    private static final String CASE_ID = "CS-123456-L1L2L3";
    private static final String POST_PATH = "/crm/cases";
    private static final String ERROR_MSG = "Something went wrong";

    @InjectMocks
    private BfinServiceImpl bfinService;

    @Mock
    private BfinConfiguration bfinConfiguration;

    @Mock
    private RestTemplate bfinRestTemplate;

    private RetryTemplate apiRetryTemplate;

    @BeforeEach
    public void setup() {
        when(bfinConfiguration.getPostPath()).thenReturn(POST_PATH);

        apiRetryTemplate = buildApiRetryTemplate();
        ReflectionTestUtils.setField(bfinService, "apiRetryTemplate", apiRetryTemplate);
    }

    @Test
    public void createInternalIssue_happyPath() throws InterruptedException, ExecutionException {
        // GIVEN
        final ErrorOmission errorOmission = buildErrorOmissionForBfin();
        final HttpEntity<ErrorSubmissionDto> request = buildRequest(errorOmission);

        final InternalCaseDto internalCaseDto = new InternalCaseDto();
        internalCaseDto.setCaseId(CASE_ID);
        when(bfinRestTemplate.postForObject(POST_PATH, request, InternalCaseDto.class)).thenReturn(internalCaseDto);

        // WHEN
        CompletableFuture<InternalCaseDto> internalCaseDtoFuture = bfinService.createInternalIssue(errorOmission);

        // THEN
        assertEquals(internalCaseDto, internalCaseDtoFuture.get());

        verify(bfinConfiguration, times(1)).getPostPath();
        verify(bfinRestTemplate, times(1)).postForObject(POST_PATH, request, InternalCaseDto.class);
    }


- How to unit test a System.exit:
Import:
<dependency>
   <groupId>com.ginsberg</groupId>
   <artifactId>junit5-system-exit</artifactId>
   <version>1.0.0</version>
   <scope>test</scope>
</dependency>

And

@Test
@ExpectSystemExitWithStatus(0)
public void run_happyPath() {
    // WHEN
    theApp.run();

    // THEN
    verify(masterService, times(1)).process();
}


- How to create a Parameterized test with 2 params:
@ParameterizedTest
@CsvSource({"null,null", "null,false", "null,true", "\"joeblog@gmail.com\",null", "\"joeblog@gmail.com\",false", "\"joeblog@gmail.com\",true"})
public void populate_emptyInputSet_expectEmptyResultSet(String developerId, Boolean includeErrors) {


- A good way to unit test a RetryConfig:
package com.sample.config;

import com.microsoft.azure.servicebus.primitives.ServiceBusException;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.MethodSource;
import org.springframework.retry.support.RetryTemplate;

import java.util.concurrent.atomic.AtomicInteger;
import java.util.stream.Stream;

import static org.junit.jupiter.api.Assertions.assertEquals;

public class RetryConfigTest {
    private RetryConfig retryConfig;

    @BeforeEach
    public void setup() {
        TopicConfiguration topicConfiguration = new TopicConfiguration();
        TopicConfiguration.RetryProperties retryProperties = new TopicConfiguration.RetryProperties();
        retryProperties.setInitialInterval(100);
        retryProperties.setMaxAttempts(3);
        retryProperties.setMultiplier(2.0);
        retryProperties.setMaxInterval(5000);
        topicConfiguration.setRetry(retryProperties);

        retryConfig = new RetryConfig(topicConfiguration);
    }

    @ParameterizedTest
    @MethodSource
    public void test_topicRetryTemplate_retriableExceptionsAreRetriedThreeTimes(Exception exception) {
        RetryTemplate topicRetryTemplate = retryConfig.topicRetryTemplate(retryConfig.exponentialBackOffPolicy());

        final AtomicInteger counter = new AtomicInteger(0);
        int count = -1;
        try {
            count = topicRetryTemplate.execute(context -> {
                counter.incrementAndGet();

                // Return exceptions every time we are called
                Exception outerException = new Exception("Test exception");
                outerException.initCause(exception);
                throw outerException;
            });
        } catch(Exception e) {
            assertEquals("Test exception", e.getMessage());
        }

        assertEquals(-1, count);
        assertEquals(3, counter.get());
    }

   private static Stream<Exception> test_topicRetryTemplate_retriableExceptionsAreRetriedThreeTimes() {
        return Stream.of(new InterruptedException(), new ServiceBusException(true));
    }

    @Test
    public void test_topicRetryTemplate_NoRetriesForOtherExceptions() {
        RetryTemplate topicRetryTemplate = retryConfig.topicRetryTemplate(retryConfig.exponentialBackOffPolicy());

        final AtomicInteger counter = new AtomicInteger(0);
        int count = -1;
        try {
            count = topicRetryTemplate.execute(context -> {
                counter.incrementAndGet();

                // Return exceptions every time we are called
                Exception outerException = new Exception("Test exception");
                throw outerException;
            });
        } catch(Exception e) {
            assertEquals("Test exception", e.getMessage());
        }

        assertEquals(-1, count);
        assertEquals(1, counter.get());
    }
}
